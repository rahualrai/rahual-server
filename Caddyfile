:80 {
  root * /usr/share/caddy
  
  # Security headers
  header {
    # Prevent clickjacking
    X-Frame-Options "SAMEORIGIN"
    # Prevent MIME sniffing
    X-Content-Type-Options "nosniff"
    # XSS protection
    X-XSS-Protection "1; mode=block"
    # Referrer policy
    Referrer-Policy "strict-origin-when-cross-origin"
    # Content Security Policy for academic site
    Content-Security-Policy "default-src 'self'; font-src 'self' fonts.googleapis.com fonts.gstatic.com; style-src 'self' 'unsafe-inline' fonts.googleapis.com; script-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';"
  }
  
  # Handle clean URLs - serve HTML files without .html extension
  @htmlFiles {
    file {path}.html
    not path *.html
  }
  rewrite @htmlFiles {path}.html
  
  # Handle 404 errors
  handle_errors {
    @404 {
      expression {http.error.status_code} == 404
    }
    rewrite @404 /404.html
    file_server
  }
  
  # Optimize caching for static assets
  @static {
    path *.css *.js *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.pdf
  }
  header @static {
    Cache-Control "public, max-age=31536000, immutable"
  }
  
  # Cache HTML with shorter duration
  @html {
    path *.html
  }
  header @html {
    Cache-Control "public, max-age=3600"
  }
  
  # Serve files
  file_server
}
